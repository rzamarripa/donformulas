<h2>Planes</h2>
<div class="row"><!-- {pl.totalIngresos[0].total | currency}}-> ag10 -->
	<div class="col-sm-12">
		<a class="btn btn-{{pl.nuevo == true ? 'primary' : 'danger'}}" role="button" data-toggle="collapse" 
			href="#collapseExample" aria-expanded="false" aria-controls="collapseExample" id="nuevoplan" ng-click="pl.nuevoPlan()">
		 {{pl.nuevo == true ? 'Nuevo' : 'Cancelar'}}
		</a>
		<div class="collapse" id="collapseExample">
			<form class="form-horizontal" role="form">
<!-- Primera Parte -->
		  	 <div class="well">	    
			    <div class="row">
			    <div class="col-sm-12">
				    <div class="col-sm-3">
					    <label>Ingresos</label>
				    	<input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.ingresos" >
				    </div>

				    <div class="col-sm-2">
				     <div class="form-group">
				     	TREMA
					    <a class="pull-left" data-toggle="popover" data-placement="top" data-content="Tasa de rendimiento minima aceptable"> <i class="fa fa-info-circle" aria-hidden="true"></i></a><br/>
					    <div class="input-group">
					      <div class="input-group-addon">%</div>
					      	<input type="number" class="form-control" placeholder="TREMA" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.trema" >
					     <!--  <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount"> -->
					    </div>
					 </div>
					</div>
				


				   <!--  <div class="col-sm-3">
					    <label>Tasa de rendimiento minima aceptable</label>
				    	<input type="number" class="form-control" placeholder="TREMA" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.trema" >
				    </div> -->
			    	<div class="col-sm-3">
					    <label for="domicilio">Factor de Recuperaci√≥n</label>
				    	<div class="form-control">{{pl.plan.factorRecuperacion | number : 2}}</div>
			    	</div>
				    <div class="col-sm-2">
					    <label>Total de Egresos</label>
				    	<div class="form-control">{{pl.plan.totalEgresos | number : 2}}</div>
				    </div>
		        </div>
		    </div>


      <!--     //////////////////////////////PRIMER ROW//////////////////////////////// -->				    
                 
                 <div class="row">
	                 <div class="col-sm-12">
					    <div class="col-sm-2">
					     <div class="form-group">
						    <label>Relacion % Cd/Ingresos</label>
						    <div class="input-group">
						      <div class="input-group-addon">%</div>
						      <div class="form-control" id="exampleInputAmount">{{(pl.totalFinalCostosDirectos) / (pl.plan.ingresos) * 100 | number : 2}}</div>
						     <!--  <input type="text" class="form-control" id="exampleInputAmount" placeholder="Amount"> -->
						    </div>
						 </div>
						</div>

						<!--  	<div class="col-sm-2">				    	
						    <label>Relacion % Cd/Ingresos</label>
					    	<div class="form-control">%{{(pl.totalFinalCostosDirectos) / (pl.plan.ingresos) * 100 | number : 2}}</div>
					    </div> -->

				    	<div class="col-sm-2">				    	
						    <label>Costo Directo</label>

								<div style="width: 150px;" class="form-control">{{pl.totalFinalCostosDirectos | currency}}</div>
		
					    </div>
				    	<div class="col-sm-2">				    	
						    <label>Gastos Indirectos</label>
					    	<div class="form-control">{{pl.plan.totalEgresos - pl.totalFinalCostosDirectos  | currency}}</div>
					    </div>
				    </div>
			    </div><br/><br/>
<!-- ////////////////////////////////////////////////////TABLA////////////////////////////////////////////////////////
 -->			     <div class="row">
					<div class="col-sm-9">
						<table class="table table-bordered">
							<thead>
								<tr>
								<th width="20%"><div class="text-center">Ingresos</div></th>
								<td width="20%">{{pl.plan.ingresos | currency}} </td>
								<tr>
							    <th  width="20%"><div class="text-center">Costos</div></th>
							     <td width="20%">{{pl.totalFinalCostosDirectos | currency}}</td>
							    
							    </tr> 
							    <tr>
							    <th  width="20%"><div class="text-center">Gastos</div></th>
							    <td  width="20%">{{pl.plan.totalEgresos - pl.totalFinalCostosDirectos  | currency}}</td>
							    
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">Utilidad Fiscal</div></th>
							    <td  width="20%">{{(pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos) | currency }} </td> 
							    
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">ISR</div></th>
							    <td  width="20%">{{((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.3 | currency }}</td>
							    
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">PTU</div></th>
							    <td  width="20%">{{((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.1 | currency}}</td>
							    
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">Utilidad Neta</div></th>
							    <td  width="20%">{{((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) -  (((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.3) -  (((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.1) | currency}}</td>
							    
							    </tr>
							    <tr>
							    <th  width="20%"> <div class="text-center">Rentabilidad</div></th>
							    <td  width="20%">{{(((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) -  (((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.3) -  (((pl.plan.ingresos) - (pl.totalFinalCostosDirectos) - (pl.plan.totalEgresos - pl.totalFinalCostosDirectos)) * 0.1)) / (pl.plan.ingresos) * 100 | currency}}</td>
							    
							    </tr>
								</tr>
							</thead>
						</table>
					</div>
				</div>
		  	</div>
<!-- Distribucion de Gastos -->
		  	<div class="well">
					<h2 style="text-align: center">Gastos Indirectos</h2>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-3">
									<label>Gastos de Oficina</label>
						    </div>
						    <div class="col-sm-2">
					    		<div class="form-control">{{pl.indirectosEmpresas[1].cantidades | currency}}</div>
						    </div>

						    <div class="col-sm-2">
							     <div class="form-group">
								    <div class="input-group">
								      <div class="input-group-addon">%</div>
								       <input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.gastosFijosOficina1" >
								    </div>
								 </div>
							</div>

						   <!--  <div class="col-sm-1">
					    		<input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.gastosFijosOficina1" >%
						    </div> -->
						    <div class="col-sm-2">
									<div class="form-control">{{(pl.indirectosEmpresas[1].cantidades) - (pl.indirectosEmpresas[1].cantidades * pl.plan.gastosFijosOficina1 )/ 100 | number : 2}}</div>
						    </div>
							</div>
				    </div>
			    </div>
			    <br/>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-3">
									<label>Gastos Indirectos de Campo</label>
						    </div>
						    <div class="col-sm-2" >
								<div class="form-control">{{pl.indirectosEmpresas[1].GasIndiCampo | currency }}</div>
						    </div>


						     <div class="col-sm-2">
							     <div class="form-group">
								    <div class="input-group">
								      <div class="input-group-addon">%</div>
								       <input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.gastosIndirectosCampo1" >
								    </div>
								 </div>
							</div>


						    <!-- <div class="col-sm-2">
					    		<input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.gastosIndirectosCampo1" >
						    </div> -->


						    <div class="col-sm-2">
									<div class="form-control">{{(pl.indirectosEmpresas[1].GasIndiCampo) - (pl.indirectosEmpresas[1].GasIndiCampo * pl.plan.gastosIndirectosCampo1)/100 | number : 2}}</div>
						    </div>
							</div>
				    </div>
			    </div>
			    <br/>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-3">
									<label>Total</label>
						    </div>
						    <div class="col-sm-2">
									<div class="form-control">{{pl.indirectosEmpresas[1].total | currency }}</div>
						    </div>
						    <div class="col-sm-2">
									<div class="form-control">{{hola}}</div>
						    </div>
						    <div class="col-sm-2">
									<div class="form-control">{{((pl.indirectosEmpresas[1].cantidades) - (pl.indirectosEmpresas[1].cantidades * pl.plan.gastosFijosOficina1 )/ 100) + ((pl.indirectosEmpresas[1].GasIndiCampo) - (pl.indirectosEmpresas[1].GasIndiCampo * pl.plan.gastosIndirectosCampo1)/100) | currency }}</div>
						    </div>
						    <div class="col-sm-2">
									<div class="form-control">{{((((pl.indirectosEmpresas[1].cantidades) - (pl.indirectosEmpresas[1].cantidades * pl.plan.gastosFijosOficina1 )/ 100) + ((pl.indirectosEmpresas[1].GasIndiCampo) - (pl.indirectosEmpresas[1].GasIndiCampo * pl.plan.gastosIndirectosCampo1)/100)) / (pl.plan.ingresos)) * 100| currency}}</div>
						    </div>
							</div>
				    </div>
			    </div>
		  	</div>
<!-- Costos Directos -->
<div class="well">
		<h2 style="text-align: center">Costos Directos</h2><br/>
			<div class="row">
				<div class="col-sm-12">
				
						<div ng-repeat="(key, costo) in pl.costos" style="margin-top: 2px" class="col-sm-4 ">
							<label for="{{key}}">{{costo.nombre}}</label>
							<input type="number" id="{{key}}" class="form-control" ng-model="costo.factor">
						</div>
									</div>
			</div><br/><br/>
					<br/>
					<br/>
			
							<table style="width:80%">
							<thead>
														
									<tr style="height: 50px;" ng-repeat="costo in pl.costosTotales">
										<td>{{costo.costo}}</td><br/>
										<td>
											<div class="col-sm-12">
												<div style="width: 80px;" class="form-control">{{(costo.total) / (pl.totalFinalCostosDirectos)*100 | number : 2}}%</div>
						    				</div>
						    			</td>
										<td >
										 	<div class="col-sm-12">
					    						<div style="width: 150px;" class="form-control">{{costo.total | currency}}</div>
						    				</div>
						    			</td>
						    			<!-- <td>
											<div class="col-sm-4">
						    						<input type="number" style="width: 150px;" class="form-control"   ng-model="cos.factor"  >%
							  			    </div>
									    </td> -->
						  			    <td>
						  			    	<div class="col-sm-12">
												<div style="width: 150px;" class="form-control">{{costo.presupuestoTotal | currency}}</div>
						    				</div>
						    			</td>	    			
									</tr>
									</thead>
									<tbody>
									<tr>
									<th></th>
										<th>
										 <div class="col-sm-12">
										     <div class="form-group">
										     <label>Total</label>
											    <div class="input-group">
											      <div class="input-group-addon">%</div>
											       <div style="width: 100px;" class="form-control">{{pl.costoTotalTotal.totalDePorcentaje}}</div>
											    </div>
											 </div>
							            </div>

											<!-- <div class="col-sm-12">
												<label>Total</label>
												<div style="width: 100px;" class="form-control">{{pl.costoTotalTotal.totalDePorcentaje}}</div>
						    				</div> -->	
										</th>
										<th>
										<div class="col-sm-12">
										 <div class="form-group">
										<label>Total</label>
										<div class="input-group">
												<div style="width: 150px;" class="form-control">{{pl.totalFinalCostosDirectos | currency}}</div>
												</div>
						    				</div>
						    				</div>									    
										</th>
									</tr>
									</tbody>	
							</table>
						</div>
Estadistica de Gastos y Productividad 
		  	<div class="well">
			  	<div class="row">
						<div class="col-sm-6">
							<h2 style="text-align: left">Estadistica de Gastos Indirectos para la Obra</h2>
							<div class="row">
							  <div class="col-sm-12">
									<div class="row">
									  <div class="col-sm-6" >
											<label>Presupuesto de Indirecto Total</label>
									  </div>
								    <div class="col-sm-6">
											<div class="form-control">{{pl.indirectosEmpresas[1].total | currency}}</div>
								    </div>
									</div>
						    </div>
					    </div>
					    <br/>
					    <div class="row">
						    <div class="col-sm-12">
									<div class="row">
								    <div class="col-sm-6">
											<label>Gastos de Oficina Mensual</label>
								    </div>
								    <div class="col-sm-6">
							    		<input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.estadisticaGastosIndirectosObraPorcentajeIndirectos" required>
								    </div>
									</div>
						    </div>
					    </div>
					    <br/>
					    <div class="row">
						    <div class="col-sm-12">
									<div class="row">
								    <div class="col-sm-6">
											<label>Gastos de Oficina Estadisticos para la Obra</label>
								    </div><!--{{(pl.plan.ingresos)*(pl.indirectosEmpresas[3].total)/ 100 | currency}}-->
								    <div class="col-sm-6">
											<div class="form-control">{{pl.indirectosEmpresas[1].estadisticos | currency}}</div>
								    </div><!--{{pl.plan.estadisticaGastosIndirectosObraGastosFijosOficina}}-->
									</div>
						    </div>
					    </div>
				    </div>
			  	</div>
		  	</div>
<!-- Ultima Tabla -->
		  	<div class="well">
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-4">
									<label>Si la obra se ejecuto en</label>
						    </div>
						    <div class="col-sm-1">
						    <label>Meses</label>
					    		<input type="number" class="form-control" placeholder="" ng-change="pl.factorRecuperacionCalc()" ng-model="pl.plan.meses" required>
						    </div>
						    <div class="col-sm-4">
									<label>Meses</label>
						    </div>
							</div>
				    </div>
			    </div>
			    <br/>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-4">
									<label>Nuevo presupuesto de Gastos Indirectos</label>
						    </div>
						    <div class="col-sm-4">
									<div class="form-control">{{pl.indirectosEmpresas[1].estadisticos / pl.plan.meses | currency }}</div>
								</div>
							</div>
				    </div>
			    </div>
			    <br/>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-4">
									<label>Ajuste presupuestal de Indirectos</label>
						    </div>
						    <div class="col-sm-4">
									<div class="form-control">{{(pl.plan.estadisticaGastosIndirectosObraPorcentajeIndirectos) - (pl.indirectosEmpresas[1].estadisticos / pl.plan.meses) | currency}}</div>
						    </div>
							</div>
				    </div>
			    </div>
			    <br/>
			    <div class="row">
				    <div class="col-sm-12">
							<div class="row">
						    <div class="col-sm-4">
									<label>Anticipo de Obra</label>
						    </div>
						    <div class="col-sm-4">
					    		<input type="number" class="form-control" placeholder="" ng-model="pl.plan.anticipoObras" >
						    </div>
						    <div class="col-sm-4">
									<div class="form-control">{{pl.plan.ingresos * pl.plan.anticipoObras / 100 | currency}}</div>
						    </div>
							</div>
				    </div>
			    </div>
		  	</div>
<!-- Estado de Resultado -->
<!-- ///////////////////////////////////////TABLA////////////////////////////////////-->	
            <div class="well">			 
                <div class="row">
					<div class="col-sm-12">
						<table class="table table-bordered">
							<thead>
							<tr>
							<th>Estados de resultados</th>
							<th>Proyectado</th>
							<th>Actual</th>
							</tr>
								<tr>
								<th width="20%"><div class="text-center">Ingresos</div></th>
								<td width="20%">{{pl.plan.ingresos | currency}} </td>
								<td width="20%"> </td>
								<tr>
							    <th  width="20%"><div class="text-center">Costos</div></th>
							     <td width="20%">{{pl.totalFinalCostosDirectos | currency}} </td>
							     <td width="20%">numero </td>
							    </tr> 
							    <tr>
							    <th  width="20%"><div class="text-center">Gastos</div></th>
							    <td  width="20%">{{((pl.indirectosEmpresas[1].cantidades) - (pl.indirectosEmpresas[1].cantidades * pl.plan.gastosFijosOficina1 )/ 100) + ((pl.indirectosEmpresas[1].GasIndiCampo) - (pl.indirectosEmpresas[1].GasIndiCampo * pl.plan.gastosIndirectosCampo1)/100) | currency }}</td>
							    <td  width="20%">numero </td>
							    </tr>
							    <tr>
							   <!--  ((pl.plan.estadisticaGastosIndirectosObraPorcentajeIndirectos) - (pl.indirectosEmpresas[1].estadisticos / pl.plan.meses)) -->
							    <th  width="20%"><div class="text-center">Utilidad Fiscal</div></th>
							    <td  width="20%">{{(pl.plan.ingresos)
							     - (pl.totalFinalCostosDirectos)
							     - ((pl.indirectosEmpresas[1].cantidades) - (pl.indirectosEmpresas[1].cantidades * pl.plan.gastosFijosOficina1 )/ 100) + ((pl.indirectosEmpresas[1].GasIndiCampo) - (pl.indirectosEmpresas[1].GasIndiCampo * pl.plan.gastosIndirectosCampo1)/100)

							     - ((pl.plan.estadisticaGastosIndirectosObraPorcentajeIndirectos) - (pl.indirectosEmpresas[1].estadisticos / pl.plan.meses)) | currency}} </td> 
							    <td  width="20%">numero </td>
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">ISR</div></th>
							    <td  width="20%">numero</td>
							    <td  width="20%">numero </td>
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">PTU</div></th>
							    <td  width="20%">numero</td>
							    <td  width="20%">numero </td>
							    </tr>
							    <tr>
							    <th  width="20%"><div class="text-center">Utilidad Neta</div></th>
							    <td  width="20%">numero</td>
							    <td  width="20%">numero </td>
							    </tr>
							    <tr>
							    <th  width="20%"> <div class="text-center">Rentabilidad</div></th>
							    <td  width="20%">numero</td>
							    <td  width="20%">numero </td>
							    </tr>
								</tr>
							</thead>
						</table>
					</div>
				</div>

			 <br/>
					<div class="row">
						<br>
						<div class="col-sm-12">
							<input type="submit" ng-click="pl.guardar(pl.costos)" value="Guardar" class="btn btn-primary" ng-show="pl.action">
							<input type="submit" ng-click="pl.actualizar(pl.costos)" value="Actualizar" class="btn btn-primary" ng-show="!pl.action">
						</div>
					</div>
		    	</div>
		  </form>
		</div>
	</div>
</div>
<br/>
<div class="row">
	<div class="col-sm-12">
		<table class="table table-bordered">
			<thead>
				<tr>
				<th width="20%"><div class="text-center">Obra</div></th>

			    <th width="20%"><div class="text-center">Ingresos</div></th>
			    <th width="20%"><div class="text-center">Anticipo de Obra</div></th>
					<th width="10%">
						<div class="text-center">
							Estatus
						</div>
					</th>
					<th width="30%">
						<div class="text-center">
							Acciones
						</div>
					</th>
				</tr>
			</thead>
			<tbody>
		    <tr ng-repeat="plan in pl.planes">
			    <td>{{pl.obra.nombre}} </td>
			    <td>{{plan.ingresos}} </td>
			    <td>{{plan.porcentajeObras | number : 2}} </td> 
			    <td>
				    <div class="text-center">
				    	<span ng-if="plan.estatus" class="label label-success">
							  Activo
							</span>
							<span ng-if="!plan.estatus" class="label label-danger">
							  Inactivo
							</span>
				    </div>
			    </td>
			    <td>
				    <div class="text-center">
				    <a class="btn btn-default" href="#" ng-click="pl.editar(plan._id)"><i class="fa fa-eye"> Ver Plan</i></a>
					    <div class="btn-group">
					    
							  <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							    <span class="caret"></span>
							    <span class="sr-only">Toggle Dropdown</span>
							  </button>
							  <ul class="dropdown-menu text-left">
							    <li><a href="#" ng-click="pl.editar(plan._id)"><i class="fa fa-pencil"></i> Editar</a></li>
							   <li><a href="#" ng-click="pl.cambiarEstatus(plan._id)"><i class="fa fa-trash"></i> Desactivar</a></li>
							 
							    
							  </ul>
							</div>
				    </div>				    
			    </td>
		    </tr>
			</tbody>
		</table>


	</div>
</div>



